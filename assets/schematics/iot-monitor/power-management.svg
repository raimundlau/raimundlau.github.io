<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600" width="900" height="600" style="background-color: white;">
  <style>
    .wire { stroke: #000; stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; }
    .symbol { stroke: #000; stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; }
    .symbol-filled { stroke: #000; stroke-width: 2; fill: #000; }
    .connection-dot { fill: #000; stroke: none; }
    .title-text { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #000; }
    .comp-name { font-family: Arial, sans-serif; font-size: 12px; font-weight: bold; fill: #000; }
    .comp-value { font-family: Arial, sans-serif; font-size: 10px; fill: #000; }
    .node-label { font-family: Courier New, monospace; font-size: 9px; fill: #444; }
    .block { stroke: #000; stroke-width: 2; fill: #f0f0f0; }
    .solar { stroke: #000; stroke-width: 2; fill: #ffffcc; }
    .battery { stroke: #000; stroke-width: 2; fill: #ccffcc; }
    .arrow { stroke: #000; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
  </style>
  
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="black"/>
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="40" y="35" class="title-text">Power Management - Solar Charging System</text>
  <line x1="40" y1="42" x2="420" y2="42" class="wire"/>
  
  <!-- Solar Panel -->
  <g transform="translate(100, 150)">
    <rect x="-60" y="-50" width="120" height="100" class="solar"/>
    <!-- Solar cell pattern -->
    <line x1="-40" y1="-30" x2="-40" y2="30" class="wire" stroke-width="1"/>
    <line x1="0" y1="-30" x2="0" y2="30" class="wire" stroke-width="1"/>
    <line x1="40" y1="-30" x2="40" y2="30" class="wire" stroke-width="1"/>
    <line x1="-50" y1="-10" x2="50" y2="-10" class="wire" stroke-width="1"/>
    <line x1="-50" y1="10" x2="50" y2="10" class="wire" stroke-width="1"/>
    
    <text x="0" y="70" text-anchor="middle" class="comp-name">Solar Panel</text>
    <text x="0" y="85" text-anchor="middle" class="comp-value">6V 2W</text>
    
    <!-- Output terminals -->
    <circle cx="-30" cy="50" r="5" class="symbol"/>
    <text x="-30" cy="55" text-anchor="middle" class="node-label">+</text>
    <circle cx="30" cy="50" r="5" class="symbol"/>
    <text x="30" cy="55" text-anchor="middle" class="node-label">-</text>
  </g>
  
  <!-- Solar Arrow -->
  <line x1="160" y1="150" x2="220" y2="150" class="arrow"/>
  
  <!-- MPPT Charge Controller -->
  <g transform="translate(300, 150)">
    <rect x="-60" y="-40" width="120" height="80" class="block"/>
    <text x="0" y="-15" text-anchor="middle" class="comp-name">MPPT Controller</text>
    <text x="0" y="5" text-anchor="middle" class="comp-value">TP4056 + DW01</text>
    <text x="0" y="25" text-anchor="middle" class="comp-value">CC/CV Charging</text>
    
    <!-- LED indicators -->
    <circle cx="-40" cy="-25" r="4" class="symbol" fill="#ff0000"/>
    <circle cx="-25" cy="-25" r="4" class="symbol" fill="#00ff00"/>
    <text x="-32" y="-35" text-anchor="middle" class="node-label">CHG</text>
  </g>
  
  <!-- Battery Arrow -->
  <line x1="360" y1="150" x2="420" y2="150" class="arrow"/>
  
  <!-- LiPo Battery -->
  <g transform="translate(500, 150)">
    <rect x="-60" y="-35" width="120" height="70" class="battery"/>
    <!-- Battery symbol inside -->
    <rect x="-40" y="-20" width="80" height="40" class="symbol"/>
    <rect x="40" y="-10" width="10" height="20" class="symbol-filled"/>
    
    <text x="0" y="55" text-anchor="middle" class="comp-name">LiPo Battery</text>
    <text x="0" y="70" text-anchor="middle" class="comp-value">3.7V 2000mAh</text>
    
    <!-- Voltage indicator -->
    <text x="0" y="0" text-anchor="middle" class="comp-value">3.7-4.2V</text>
  </g>
  
  <!-- Regulator Arrow -->
  <line x1="560" y1="150" x2="620" y2="150" class="arrow"/>
  
  <!-- Voltage Regulator -->
  <g transform="translate(700, 150)">
    <rect x="-60" y="-35" width="120" height="70" class="block"/>
    <text x="0" y="-10" text-anchor="middle" class="comp-name">LDO Regulator</text>
    <text x="0" y="10" text-anchor="middle" class="comp-value">AMS1117-3.3</text>
    
    <!-- Output -->
    <line x1="60" y1="0" x2="100" y2="0" class="arrow"/>
    <text x="130" y="5" text-anchor="middle" class="node-label">3.3V</text>
  </g>
  
  <!-- Protection Circuit Detail -->
  <g transform="translate(300, 320)">
    <text x="0" y="-60" text-anchor="middle" class="comp-name">Battery Protection Circuit</text>
    
    <!-- Block diagram -->
    <rect x="-150" y="-40" width="80" height="40" class="block"/>
    <text x="-110" y="-15" text-anchor="middle" class="comp-value">Over-charge</text>
    <text x="-110" y="0" text-anchor="middle" class="comp-value">4.25V</text>
    
    <rect x="-50" y="-40" width="80" height="40" class="block"/>
    <text x="-10" y="-15" text-anchor="middle" class="comp-value">Over-discharge</text>
    <text x="-10" y="0" text-anchor="middle" class="comp-value">2.5V</text>
    
    <rect x="50" y="-40" width="80" height="40" class="block"/>
    <text x="90" y="-15" text-anchor="middle" class="comp-value">Over-current</text>
    <text x="90" y="0" text-anchor="middle" class="comp-value">3A</text>
  </g>
  
  <!-- Power Budget -->
  <g transform="translate(650, 320)">
    <text x="0" y="-60" text-anchor="middle" class="comp-name">Power Budget</text>
    
    <rect x="-100" y="-40" width="200" height="120" class="block"/>
    
    <text x="-80" y="-20" class="comp-value">ESP32 Active:</text>
    <text x="60" y="-20" class="comp-value">80mA</text>
    
    <text x="-80" y="0" class="comp-value">Sensors:</text>
    <text x="60" y="0" class="comp-value">15mA</text>
    
    <text x="-80" y="20" class="comp-value">WiFi Tx:</text>
    <text x="60" y="20" class="comp-value">150mA</text>
    
    <text x="-80" y="40" class="comp-value">Deep Sleep:</text>
    <text x="60" y="40" class="comp-value">10µA</text>
    
    <line x1="-90" y1="55" x2="90" y2="55" class="wire"/>
    
    <text x="-80" y="70" class="comp-name">Battery Life:</text>
    <text x="60" y="70" class="comp-value">~72h</text>
  </g>
  
  <!-- Solar Irradiance Graph -->
  <g transform="translate(120, 450)">
    <text x="80" y="-30" text-anchor="middle" class="comp-name">Solar Charging Profile</text>
    
    <!-- Axes -->
    <line x1="0" y1="0" x2="200" y2="0" class="wire"/>
    <line x1="0" y1="0" x2="0" y2="-80" class="wire"/>
    
    <!-- Solar curve (simplified sine) -->
    <path d="M 0 0 Q 50 -60, 100 -70 Q 150 -60, 200 0" class="wire" fill="none"/>
    
    <text x="0" y="15" class="node-label">6AM</text>
    <text x="100" y="15" class="node-label">12PM</text>
    <text x="200" y="15" class="node-label">6PM</text>
    <text x="-20" y="-70" class="node-label">2W</text>
  </g>
  
  <!-- Ground Reference -->
  <g transform="translate(450, 520)">
    <line x1="-400" y1="0" x2="350" y2="0" class="wire" stroke-width="3"/>
    <text x="-380" y="20" class="node-label">GND</text>
    
    <!-- Ground symbol -->
    <g transform="translate(0, 5)">
      <line x1="0" y1="0" x2="0" y2="10" class="wire"/>
      <line x1="-15" y1="10" x2="15" y2="10" class="wire"/>
      <line x1="-10" y1="15" x2="10" y2="15" class="wire"/>
      <line x1="-5" y1="20" x2="5" y2="20" class="wire"/>
    </g>
  </g>
  
  <!-- Legend -->
  <g transform="translate(40, 570)">
    <text x="0" y="0" class="comp-value">Power Chain: Solar Panel (6V 2W) → MPPT Charger → LiPo Battery (3.7V 2Ah) → LDO Regulator → 3.3V System Rail</text>
  </g>
</svg>